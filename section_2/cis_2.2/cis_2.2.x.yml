{{ if .Vars.win2019cis_level_1 }}
command:
  {{ if .Vars.win2019cis_2_2_1 }}
  access_cred_mgr:
    title: 2.2.1 | Ensure 'Access Credential Manager as a trusted caller' is set to 'No One' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname TrustedCredManAccessPrivilege
    exit-status: 0
    stdout:
    - 'Not Defined'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.1
  {{ end }}
  {{ if .Vars.win2019cis_2_2_4 }}
  act_as_OS:
    title: 2.2.4 | Ensure 'Act as part of the operating system' is set to 'No One' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname TcbPrivilege
    exit-status: 0
    stdout:
    - 'Not Defined'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.4
  {{ end }}
  {{ if .Vars.win2019cis_2_2_6 }}
  mem_quotas_for_proc:
    title: 2.2.6 | Ensure 'Adjust memory quotas for a process' is set to 'Administrators, LOCAL SERVICE, NETWORK SERVICE'  
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname IncreaseQuotaPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators LOCAL SERVICE NETWORK SERVICE/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.6
  {{ end }}
  {{ if .Vars.win2019cis_2_2_10 }}
  backup_users:
    title: 2.2.10 | Ensure 'Back up files and directories' is set to 'Administrators'  
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname BackupPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.10
  {{ end }}
  {{ if .Vars.win2019cis_2_2_12 }}
  timezone_users:
    title: 2.2.12 | Ensure 'Change the time Zone' is set to 'Administrators, LOCAL SERVICE'  
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname TimeZonePrivilege
    exit-status: 0
    stdout:
    - '^Policy:.*:\sAdministrators LOCAL SERVICE/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.12
  {{ end }}
  {{ if .Vars.win2019cis_2_2_13 }}
  pagefile_users:
    title: 2.2.13 | Ensure 'Create a pagefile' is set to 'Administrators' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname CreatePagefilePrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.13
  {{ end }}
  {{ if .Vars.win2019cis_2_2_14 }}
  token_object_users:
    title: 2.2.14 | Ensure 'Create a token object' is set to 'No One' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname CreateTokenPrivilege
    exit-status: 0
    stdout:
    - 'Not Defined'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.14
  {{ end }}
  {{ if .Vars.win2019cis_2_2_15 }}
  global_object_users:
    title: 2.2.15 | Ensure 'Create global objects' is set to 'Administrators, LOCAL SERVICE, NETWORK SERVICE, SERVICE' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname CreateGlobalPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators LOCAL SERVICE NETWORK SERVICE SERVICE/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.15
  {{ end }}
  {{ if .Vars.win2019cis_2_2_16 }}
  perm_shared_object_users:
    title: 2.2.16 | Ensure 'Create permanent shared objects' is set to 'No One' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname CreatePermanentPrivilege
    exit-status: 0
    stdout:
    - 'Not Defined'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.16
  {{ end }}
  {{ if .Vars.win2019cis_2_2_19 }}
  debug_progs_users:
    title: 2.2.19 | Ensure 'Debug programs' is set to 'Administrators' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname DebugPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.19
  {{ end }}
  {{ if .Vars.win2019cis_2_2_22 }}
  deny_batch_job_logon_users:
    title: 2.2.22 | Ensure 'Deny log on as a batch job' to include 'Guests'
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname DenyBatchLogonRight
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sGuests/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.22
  {{ end }}
  {{ if .Vars.win2019cis_2_2_23 }}
  deny_service_logon_users:
    title: 2.2.23 | Ensure 'Deny log on as a service' to include 'Guests' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname DenyServiceLogonRight
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sGuests/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.23
  {{ end }}
  {{ if .Vars.win2019cis_2_2_24 }}
  deny_local_logon_users:
    title: 2.2.24 | Ensure 'Deny log on locally' to include 'Guests' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname DenyInteractiveLogonRight
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sGuests/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.24
  {{ end }}
  {{ if .Vars.win2019cis_2_2_29 }}
  force_remote_shutdown_users:
    title: 2.2.29 | Ensure 'Force shutdown from a remote system' is set to 'Administrators' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname ShutdownPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.29
  {{ end }}
  {{ if .Vars.win2019cis_2_2_30 }}
  generate_security_audits:
    title: 2.2.30 | Ensure 'Generate security audits' is set to 'LOCAL SERVICE, NETWORK SERVICE'
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname AuditPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sLOCAL SERVICE NETWORK SERVICE/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.30
      CISv8:
      - 8.2
      CISv8_IG1: true
      CISv8_IG2: true
      CISv8_IG3: true
  {{ end }}
  {{ if .Vars.win2019cis_2_2_33 }}
  increase_scheduling:
    title: 2.2.33 | Ensure 'Increase scheduling priority' is set to 'Administrators, Window Manager\Window Manager Group'
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname IncreaseBasePriorityPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.33
      CISv8:
      - 6.8
      CISv8_IG1: false
      CISv8_IG2: false
      CISv8_IG3: true
  {{ end }}
  {{ if .Vars.win2019cis_2_2_34 }}
  load_unload_drivers:
    title: 2.2.34 | Ensure 'Load and unload device drivers' is set to 'Administrators'
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname LoadDriverPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.34
  {{ end }}
  {{ if .Vars.win2019cis_2_2_35 }}
  lock_pages_memory:
    title: 2.2.35 | Ensure 'Lock pages in memory' is set to 'No One' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname LockMemoryPrivilege
    exit-status: 0
    stdout:
    - 'Not Defined'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.35
  {{ end }}
  {{ if .Vars.win2019cis_2_2_39 }}
  modify_object_label:
    title: 2.2.39 | Ensure 'Modify an object label' is set to 'No One' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname RelabelPrivilege
    exit-status: 0
    stdout:
    - 'Not Defined'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.39
  {{ end }}
  {{ if .Vars.win2019cis_2_2_40 }}
  modify_fw_values:
    title: 2.2.40 | Ensure 'Modify firmware environment values' is set to 'Administrators' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname SystemEnvironmentPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.40
  {{ end }}
  {{ if .Vars.win2019cis_2_2_41 }}
  volume_maintain_tasks:
    title: 2.2.41 | Ensure 'Perform volume maintenance tasks' is set to 'Administrators' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname ManageVolumePrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.41
  {{ end }}
  {{ if .Vars.win2019cis_2_2_42 }}
  profile_single_process:
    title: 2.2.42 | Ensure 'Profile single process' is set to 'Administrators' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname ProfileSingleProcessPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.42
  {{ end }}
  {{ if .Vars.win2019cis_2_2_43 }}
  profile_system_performance:
    title: 2.2.43 | Ensure 'Profile system performance' is set to 'Administrators, NT SERVICE\WdiServiceHost' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname SystemProfilePrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators NT SERVICE\WdiServiceHost/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.43
  {{ end }}
  {{ if .Vars.win2019cis_2_2_44 }}
  replace_process_token:
    title: 2.2.44 | Ensure 'Replace a process level token' is set to 'LOCAL SERVICE, NETWORK SERVICE' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname AssignPrimaryTokenPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sLOCAL SERVICE, NETWORK SERVICE/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.44
      CISv8:
      - 6.8
      CISv8_IG1: false
      CISv8_IG2: false
      CISv8_IG3: true
  {{ end }}
  {{ if .Vars.win2019cis_2_2_45 }}
  restore_files_dirs:
    title: 2.2.45 | Ensure 'Restore files and directories' is set to 'Administrators' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname RestorePrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\s(Administrators|Backup Operators)/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.45
  {{ end }}
  {{ if .Vars.win2019cis_2_2_46 }}
  shutdown_system_users:
    title: 2.2.46 | Ensure 'Shut down the system' is set to 'Administrators' 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname ShutdownPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.46
  {{ end }}
  {{ if .Vars.win2019cis_2_2_48 }}
  take_file_ownership:
    title: 2.2.48 | Ensure 'Take ownership of files or other objects' is set to 'Administrators'
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname TakeOwnershipPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators/'
    meta:
      Domain_Controller: 1
      Member_Server: 1
      CIS_ID: 2.2.1
  {{ end }}
{{ end }}