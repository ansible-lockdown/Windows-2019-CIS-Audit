{{ if not .Vars.is_domain_controller}}
  {{ if .Vars.win2019cis_level_1 }}
command:
  {{ if .Vars.win2019cis_2_2_3 }}
  access_dc_admins:
    title: 2.2.3 | Ensure 'Access this computer from the network' is set to 'Administrators, Authenticated Users' (MS only) 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname NetworkLogonRight
    exit-status: 0
    stdout:
    - '/^Policy:.*:\s{{ .Vars.win2019cis_MS_access_from_network}}/'
    meta:
      Member_Server: 1
      CIS_ID: 2.2.3
  {{ end }}
  {{ if .Vars.win2019cis_2_2_7 }}
  allow_logon_locally:
    title: 2.2.7 |  Ensure 'Allow log on locally' is set to 'Administrators' (MS only) 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname InteractiveLogonRight
    exit-status: 0
    stdout:
    - '/^Policy:.*:\s{{ .Vars.win2019cis_MS_allow_logon_local_users }}/'
    meta:
      Member_Server: 1
      CIS_ID: 2.2.7
  {{ end }}
  {{ if .Vars.win2019cis_2_2_9 }}
  allow_logon_RDP_MS:
    title: 2.2.9 |  Ensure 'Allow log on through Remote Desktop Services' is set to 'Administrators, Remote Desktop Users' (MS only)  
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname RemoteInteractiveLogonRight
    exit-status: 0
    stdout:
    - '/Policy:.*:\s{{ .Vars.win2019cis_MS_allow_logon_RDP_users }}/'
    meta:
      Member_Server: 1
      CIS_ID: 2.2.9
  {{ end }}
  {{ if .Vars.win2019cis_2_2_11 }}
  time_users_ms:
    title: 2.2.11 | Ensure 'Change the system time' is set to 'Administrators, LOCAL SERVICE' | MS
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname SystemtimePrivilege
    exit-status: 0
    stdout:
    - '^Policy:.*:\sAdministrators LOCAL SERVICE/'
    meta:
      Member_Server: 1
      CIS_ID: 2.2.11
  {{ end }}
  {{ if .Vars.win2019cis_2_2_18 }}
  symlink_users_MS:
    title: 2.2.18 |  Ensure 'Create symbolic links' is set to 'Administrators, NT VIRTUAL MACHINE\Virtual Machines' (MS only)
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname CreateSymbolicLinkPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators/'
    meta:
      Member_Server: 1
      CIS_ID: 2.2.18
  {{ end }}
  {{ if .Vars.win2019cis_2_2_21 }}
  deny_network_access_MS:
    title: 2.2.21 | Ensure 'Deny access to this computer from the network' to include 'Guests, Local account and member of Administrators group' (MS only) 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname DenyNetworkLogonRight
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sGuests Local account Administrators/'
    meta:
      Member_Server: 1
      CIS_ID: 2.2.21
  {{ end }}
  {{ if .Vars.win2019cis_2_2_26 }}
  deny_login_RDP_users_MS:
    title: 2.2.26 | Ensure 'Deny log on through Remote Desktop Services' to include 'Guests, Local account' (MS only) 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname RemoteInteractiveLogonRight
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sGuests Local account/'
    - '!/./'
    meta:
      Member_Server: 1
      CIS_ID: 2.2.26
  {{ end }}
  {{ if .Vars.win2019cis_2_2_28 }}
  trusted_deleg_MS:
    title: 2.2.28 | Ensure 'Enable computer and user accounts to be trusted for delegation' is set to 'No One'  (MS only) 
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname EnableDelegationPrivilege
    exit-status: 0
    stdout:
    - 'Not Defined'
    meta:
      Member_Server: 1
      CIS_ID: 2.2.28
  {{ end }}
  {{ if .Vars.win2019cis_2_2_32 }}
  impersonate_client_MS:
    title: 2.2.32 | Ensure 'Impersonate a client after authentication' is set to 'Administrators, LOCAL SERVICE, NETWORK SERVICE, SERVICE' and (when the Web Server (IIS) Role with Web Services Role Service is installed) 'IIS_IUSRS' (MS only)
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname EnableDelegationPrivilege
    exit-status: 0
    stdout:
    - '/^Policy:.*:\sAdministrators LOCAL SERVICE NETWORK SERVICE SERVICE/'
      {{ if .Vars.win2019cis_use_iis }}
    - '/^Policy:.*:\s.*IIS_IUSRS/'
    meta:
      Member_Server: 1
      CIS_ID: 2.2.32
  {{ end }}
  {{ end }}
  {{ if .Vars.win2019cis_2_2_38 }}
  manage_audit_sec_log_MS:
    title: 2.2.38 | Ensure 'Manage auditing and security log' is set to 'Administrators' (MS only)
    exec: powershell {{ .Vars.audit_content }}{{ .Vars.gpo_regex_script }} -filename {{ .Vars.gpresult_file }} -policyname SecurityPrivilege
    exit-status: 0
    stdout:
    - 'Administrators'
    meta:
      Member_Server: 1
      CIS_ID: 2.2.38
  {{ end }}
{{ end }}
{{ end }}